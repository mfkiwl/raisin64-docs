

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>commit.v &mdash; Raisin64 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="de_canonicalize.v" href="de_canonicalize.html" />
    <link rel="prev" title="Verilog Module Index" href="../modules.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Raisin64
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../cpu.html">Raisin64 CPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../software.html">Code Snippets and Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nexysddr.html">Nexys 4 DDR Reference Implementation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../modules.html">Reference Index</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../isa.html">Raisin64 Instruction Set</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../modules.html">Verilog Module Index</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">commit.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="de_canonicalize.html">de_canonicalize.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="debug_control.html">debug_control.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="decode.html">decode.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="ex_advint.html">ex_advint.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="ex_advint_s1.html">ex_advint_s1.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="ex_alu.html">ex_alu.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="ex_alu_s1.html">ex_alu_s1.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="ex_branch.html">ex_branch.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="ex_memory.html">ex_memory.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="fetch.html">fetch.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="ff_sync.html">ff_sync.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="jtag_reg.html">schedule.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="jtag_state_machine.html">jtag_state_machine.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="jtaglet.html">jtaglet.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="memory_map.html">memory_map.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="pipeline.html">pipeline.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="raisin64.html">raisin64.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="ram.html">ram.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="regfile.html">regfile.v</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedule.html">schedule.v</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Raisin64</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../modules.html">Reference Index</a> &raquo;</li>
        
          <li><a href="../modules.html">Verilog Module Index</a> &raquo;</li>
        
      <li>commit.v</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/cpu/modules/commit.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="commit-v">
<h1>commit.v<a class="headerlink" href="#commit-v" title="Permalink to this headline">Â¶</a></h1>
<object data="../../_images/symbol-e8b7f97dc6363c64d2d425d6e10076f81fc63246.svg" type="image/svg+xml">
            <p class="warning">module commit(
    //# {{clocks|Clocking}}
    input clk,
    input rst_n,

    //# {{data|Execution Units Results}}
    input[63:0] alu1_result,
    input[63:0] alu2_result,
    input[63:0] advint_result,
    input[63:0] advint_result2,
    input[63:0] memunit_result,
    input[63:0] branch_result,

    input[5:0] alu1_rn,
    input[5:0] alu2_rn,
    input[5:0] advint_rn,
    input[5:0] advint_rn2,
    input[5:0] memunit_rn,

    //# {{control|Execution Units Control}}
    input alu1_valid,
    input alu2_valid,
    input advint_valid,
    input memunit_valid,
    input branch_valid,

    output alu1_stall,
    output alu2_stall,
    output advint_stall,
    output memunit_stall,
    output branch_stall,

    //# {{data|Register File Data}}
    output[63:0] write_data,
    output[5:0] write_rn
    );

    localparam STATE_IDLE = 3'h0;
    localparam STATE_P1 = 3'h1;
    localparam STATE_P2 = 3'h2;
    localparam STATE_P3 = 3'h3;
    localparam STATE_P4 = 3'h4;
    localparam STATE_P5 = 3'h5;
    localparam STATE_P6 = 3'h6;

    reg[2:0] state, next_state;

    reg[5:0] pending_rn[1:6];
    reg[63:0] pending_data[1:6];
    reg[6:1] pending_valid;

    //TODO Finish exception handling by un-stalling the ex units in strict order of issue (via external counting table)
    //For now, no exceptions are implemented.
    assign alu1_stall = pending_valid[1] &amp;&amp; state != STATE_P1;
    assign alu2_stall = pending_valid[2] &amp;&amp; state != STATE_P2;
    assign advint_stall = (pending_valid[3] &amp;&amp; state != STATE_P3) | (pending_valid[4] &amp;&amp; state != STATE_P4);
    assign memunit_stall = pending_valid[5] &amp;&amp; state != STATE_P5;
    assign branch_stall = pending_valid[6] &amp;&amp; state != STATE_P6;

    integer i;


    //TODO A side-effect of the current implemtation is that a short running instruction issued after a long running
    //one which affects the same destination register might get written/overwritten in the wrong order. This will be
    //fixed by the proposed PC instruction graduation control table necessary for exceptions

    //The *unit*_valid signals need to remain high for only one cycle per transaction or all hell will break loose.
    always &#64;(posedge clk or negedge rst_n)
    begin
        if(~rst_n) begin
            for(i = 1; i &lt;= 6; i = i + 1) begin
                pending_data[i] &lt;= 64'h0;
                pending_rn[i] &lt;= 6'h0;
                pending_valid[i] &lt;= 0;
            end
        end else begin
            case(state)
            STATE_P1: pending_valid[1] &lt;= 0;
            STATE_P2: pending_valid[2] &lt;= 0;
            STATE_P3: pending_valid[3] &lt;= 0;
            STATE_P4: pending_valid[4] &lt;= 0;
            STATE_P5: pending_valid[5] &lt;= 0;
            STATE_P6: pending_valid[6] &lt;= 0;
            endcase

            if(alu1_valid &amp; |alu1_rn) begin
                pending_data[1] &lt;= alu1_result;
                pending_rn[1] &lt;= alu1_rn;
                pending_valid[1] &lt;= 1;

            end if(alu2_valid &amp; |alu2_rn) begin
                pending_data[2] &lt;= alu2_result;
                pending_rn[2] &lt;= alu2_rn;
                pending_valid[2] &lt;= 1;

            end if(advint_valid &amp; (|advint_rn | |advint_rn2)) begin
                pending_data[3] &lt;= advint_result;
                pending_rn[3] &lt;= advint_rn;
                pending_valid[3] &lt;= 1;
                pending_data[4] &lt;= advint_result2;
                pending_rn[4] &lt;= advint_rn2;
                pending_valid[4] &lt;= 1;

            end if(memunit_valid &amp; |memunit_rn) begin
                pending_data[5] &lt;= memunit_result;
                pending_rn[5] &lt;= memunit_rn;
                pending_valid[5] &lt;= 1;

            end if(branch_valid) begin
                pending_data[6] &lt;= branch_result;
                pending_rn[6] &lt;= 6'd63;
                pending_valid[6] &lt;= 1;
            end
        end
    end

    always &#64;(posedge clk or negedge rst_n)
    begin
        if(~rst_n) state &lt;= STATE_IDLE;
        else state &lt;= next_state;
    end

    always &#64;(*)
    begin
        if((pending_valid[6] &amp; state != STATE_P6) | branch_valid) next_state = STATE_P6;
        else if((pending_valid[5] &amp; state != STATE_P5) | (memunit_valid &amp; |memunit_rn)) next_state = STATE_P5;
        else if((pending_valid[4] &amp; state != STATE_P4) | (advint_valid &amp; |advint_rn2)) next_state = STATE_P4;
        else if((pending_valid[3] &amp; state != STATE_P3) | (advint_valid &amp; |advint_rn)) next_state = STATE_P3;
        else if((pending_valid[2] &amp; state != STATE_P2) | (alu2_valid &amp; |alu2_rn)) next_state = STATE_P2;
        else if((pending_valid[1] &amp; state != STATE_P1) | (alu1_valid &amp; |alu1_rn)) next_state = STATE_P1;
        else next_state = STATE_IDLE;
    end

    assign write_data = state == STATE_P1 ? pending_data[1] :
                        state == STATE_P2 ? pending_data[2] :
                        state == STATE_P3 ? pending_data[3] :
                        state == STATE_P4 ? pending_data[4] :
                        state == STATE_P5 ? pending_data[5] :
                        state == STATE_P6 ? pending_data[6] :
                        64'h0;

    assign write_rn = state == STATE_P1 ? pending_rn[1] :
                      state == STATE_P2 ? pending_rn[2] :
                      state == STATE_P3 ? pending_rn[3] :
                      state == STATE_P4 ? pending_rn[4] :
                      state == STATE_P5 ? pending_rn[5] :
                      state == STATE_P6 ? pending_rn[6] :
                      6'h0;

endmodule</p></object>
<div class="highlight-verilog notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="n">commit</span><span class="p">(</span>
    <span class="c1">//# {{clocks|Clocking}}</span>
    <span class="k">input</span> <span class="n">clk</span><span class="p">,</span>
    <span class="k">input</span> <span class="n">rst_n</span><span class="p">,</span>

    <span class="c1">//# {{data|Execution Units Results}}</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">alu1_result</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">alu2_result</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">advint_result</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">advint_result2</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">memunit_result</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">branch_result</span><span class="p">,</span>

    <span class="k">input</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">alu1_rn</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">alu2_rn</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">advint_rn</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">advint_rn2</span><span class="p">,</span>
    <span class="k">input</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">memunit_rn</span><span class="p">,</span>

    <span class="c1">//# {{control|Execution Units Control}}</span>
    <span class="k">input</span> <span class="n">alu1_valid</span><span class="p">,</span>
    <span class="k">input</span> <span class="n">alu2_valid</span><span class="p">,</span>
    <span class="k">input</span> <span class="n">advint_valid</span><span class="p">,</span>
    <span class="k">input</span> <span class="n">memunit_valid</span><span class="p">,</span>
    <span class="k">input</span> <span class="n">branch_valid</span><span class="p">,</span>

    <span class="k">output</span> <span class="n">alu1_stall</span><span class="p">,</span>
    <span class="k">output</span> <span class="n">alu2_stall</span><span class="p">,</span>
    <span class="k">output</span> <span class="n">advint_stall</span><span class="p">,</span>
    <span class="k">output</span> <span class="n">memunit_stall</span><span class="p">,</span>
    <span class="k">output</span> <span class="n">branch_stall</span><span class="p">,</span>

    <span class="c1">//# {{data|Register File Data}}</span>
    <span class="k">output</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">write_data</span><span class="p">,</span>
    <span class="k">output</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">write_rn</span>
    <span class="p">);</span>

    <span class="k">localparam</span> <span class="no">STATE_IDLE</span> <span class="o">=</span> <span class="mh">3&#39;h0</span><span class="p">;</span>
    <span class="k">localparam</span> <span class="no">STATE_P1</span> <span class="o">=</span> <span class="mh">3&#39;h1</span><span class="p">;</span>
    <span class="k">localparam</span> <span class="no">STATE_P2</span> <span class="o">=</span> <span class="mh">3&#39;h2</span><span class="p">;</span>
    <span class="k">localparam</span> <span class="no">STATE_P3</span> <span class="o">=</span> <span class="mh">3&#39;h3</span><span class="p">;</span>
    <span class="k">localparam</span> <span class="no">STATE_P4</span> <span class="o">=</span> <span class="mh">3&#39;h4</span><span class="p">;</span>
    <span class="k">localparam</span> <span class="no">STATE_P5</span> <span class="o">=</span> <span class="mh">3&#39;h5</span><span class="p">;</span>
    <span class="k">localparam</span> <span class="no">STATE_P6</span> <span class="o">=</span> <span class="mh">3&#39;h6</span><span class="p">;</span>

    <span class="kt">reg</span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">state</span><span class="p">,</span> <span class="n">next_state</span><span class="p">;</span>

    <span class="kt">reg</span><span class="p">[</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">pending_rn</span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">6</span><span class="p">];</span>
    <span class="kt">reg</span><span class="p">[</span><span class="mh">63</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">pending_data</span><span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">6</span><span class="p">];</span>
    <span class="kt">reg</span><span class="p">[</span><span class="mh">6</span><span class="o">:</span><span class="mh">1</span><span class="p">]</span> <span class="n">pending_valid</span><span class="p">;</span>

    <span class="c1">//TODO Finish exception handling by un-stalling the ex units in strict order of issue (via external counting table)</span>
    <span class="c1">//For now, no exceptions are implemented.</span>
    <span class="k">assign</span> <span class="n">alu1_stall</span> <span class="o">=</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P1</span><span class="p">;</span>
    <span class="k">assign</span> <span class="n">alu2_stall</span> <span class="o">=</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P2</span><span class="p">;</span>
    <span class="k">assign</span> <span class="n">advint_stall</span> <span class="o">=</span> <span class="p">(</span><span class="n">pending_valid</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">pending_valid</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P4</span><span class="p">);</span>
    <span class="k">assign</span> <span class="n">memunit_stall</span> <span class="o">=</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P5</span><span class="p">;</span>
    <span class="k">assign</span> <span class="n">branch_stall</span> <span class="o">=</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P6</span><span class="p">;</span>

    <span class="k">integer</span> <span class="n">i</span><span class="p">;</span>


    <span class="c1">//TODO A side-effect of the current implemtation is that a short running instruction issued after a long running</span>
    <span class="c1">//one which affects the same destination register might get written/overwritten in the wrong order. This will be</span>
    <span class="c1">//fixed by the proposed PC instruction graduation control table necessary for exceptions</span>

    <span class="c1">//The *unit*_valid signals need to remain high for only one cycle per transaction or all hell will break loose.</span>
    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">negedge</span> <span class="n">rst_n</span><span class="p">)</span>
    <span class="k">begin</span>
        <span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
            <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mh">6</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mh">1</span><span class="p">)</span> <span class="k">begin</span>
                <span class="n">pending_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">64&#39;h0</span><span class="p">;</span>
                <span class="n">pending_rn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">6&#39;h0</span><span class="p">;</span>
                <span class="n">pending_valid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
            <span class="k">end</span>
        <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
            <span class="k">case</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
            <span class="nl">STATE_P1:</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
            <span class="nl">STATE_P2:</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
            <span class="nl">STATE_P3:</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
            <span class="nl">STATE_P4:</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
            <span class="nl">STATE_P5:</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
            <span class="nl">STATE_P6:</span> <span class="n">pending_valid</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
            <span class="k">endcase</span>

            <span class="k">if</span><span class="p">(</span><span class="n">alu1_valid</span> <span class="o">&amp;</span> <span class="o">|</span><span class="n">alu1_rn</span><span class="p">)</span> <span class="k">begin</span>
                <span class="n">pending_data</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">alu1_result</span><span class="p">;</span>
                <span class="n">pending_rn</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">alu1_rn</span><span class="p">;</span>
                <span class="n">pending_valid</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="p">;</span>

            <span class="k">end</span> <span class="k">if</span><span class="p">(</span><span class="n">alu2_valid</span> <span class="o">&amp;</span> <span class="o">|</span><span class="n">alu2_rn</span><span class="p">)</span> <span class="k">begin</span>
                <span class="n">pending_data</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">alu2_result</span><span class="p">;</span>
                <span class="n">pending_rn</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">alu2_rn</span><span class="p">;</span>
                <span class="n">pending_valid</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="p">;</span>

            <span class="k">end</span> <span class="k">if</span><span class="p">(</span><span class="n">advint_valid</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">|</span><span class="n">advint_rn</span> <span class="o">|</span> <span class="o">|</span><span class="n">advint_rn2</span><span class="p">))</span> <span class="k">begin</span>
                <span class="n">pending_data</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">advint_result</span><span class="p">;</span>
                <span class="n">pending_rn</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">advint_rn</span><span class="p">;</span>
                <span class="n">pending_valid</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="p">;</span>
                <span class="n">pending_data</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">advint_result2</span><span class="p">;</span>
                <span class="n">pending_rn</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">advint_rn2</span><span class="p">;</span>
                <span class="n">pending_valid</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="p">;</span>

            <span class="k">end</span> <span class="k">if</span><span class="p">(</span><span class="n">memunit_valid</span> <span class="o">&amp;</span> <span class="o">|</span><span class="n">memunit_rn</span><span class="p">)</span> <span class="k">begin</span>
                <span class="n">pending_data</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">memunit_result</span><span class="p">;</span>
                <span class="n">pending_rn</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">memunit_rn</span><span class="p">;</span>
                <span class="n">pending_valid</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="p">;</span>

            <span class="k">end</span> <span class="k">if</span><span class="p">(</span><span class="n">branch_valid</span><span class="p">)</span> <span class="k">begin</span>
                <span class="n">pending_data</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">branch_result</span><span class="p">;</span>
                <span class="n">pending_rn</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">6</span><span class="mi">&#39;d63</span><span class="p">;</span>
                <span class="n">pending_valid</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="p">;</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">negedge</span> <span class="n">rst_n</span><span class="p">)</span>
    <span class="k">begin</span>
        <span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="n">rst_n</span><span class="p">)</span> <span class="n">state</span> <span class="o">&lt;=</span> <span class="no">STATE_IDLE</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">state</span> <span class="o">&lt;=</span> <span class="n">next_state</span><span class="p">;</span>
    <span class="k">end</span>

    <span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span>
    <span class="k">begin</span>
        <span class="k">if</span><span class="p">((</span><span class="n">pending_valid</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P6</span><span class="p">)</span> <span class="o">|</span> <span class="n">branch_valid</span><span class="p">)</span> <span class="n">next_state</span> <span class="o">=</span> <span class="no">STATE_P6</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">pending_valid</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">memunit_valid</span> <span class="o">&amp;</span> <span class="o">|</span><span class="n">memunit_rn</span><span class="p">))</span> <span class="n">next_state</span> <span class="o">=</span> <span class="no">STATE_P5</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">pending_valid</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">advint_valid</span> <span class="o">&amp;</span> <span class="o">|</span><span class="n">advint_rn2</span><span class="p">))</span> <span class="n">next_state</span> <span class="o">=</span> <span class="no">STATE_P4</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">pending_valid</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">advint_valid</span> <span class="o">&amp;</span> <span class="o">|</span><span class="n">advint_rn</span><span class="p">))</span> <span class="n">next_state</span> <span class="o">=</span> <span class="no">STATE_P3</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">pending_valid</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">alu2_valid</span> <span class="o">&amp;</span> <span class="o">|</span><span class="n">alu2_rn</span><span class="p">))</span> <span class="n">next_state</span> <span class="o">=</span> <span class="no">STATE_P2</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">pending_valid</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">state</span> <span class="o">!=</span> <span class="no">STATE_P1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">alu1_valid</span> <span class="o">&amp;</span> <span class="o">|</span><span class="n">alu1_rn</span><span class="p">))</span> <span class="n">next_state</span> <span class="o">=</span> <span class="no">STATE_P1</span><span class="p">;</span>
        <span class="k">else</span> <span class="n">next_state</span> <span class="o">=</span> <span class="no">STATE_IDLE</span><span class="p">;</span>
    <span class="k">end</span>

    <span class="k">assign</span> <span class="n">write_data</span> <span class="o">=</span> <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P1</span> <span class="o">?</span> <span class="n">pending_data</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">:</span>
                        <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P2</span> <span class="o">?</span> <span class="n">pending_data</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">:</span>
                        <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P3</span> <span class="o">?</span> <span class="n">pending_data</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">:</span>
                        <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P4</span> <span class="o">?</span> <span class="n">pending_data</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span> <span class="o">:</span>
                        <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P5</span> <span class="o">?</span> <span class="n">pending_data</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span> <span class="o">:</span>
                        <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P6</span> <span class="o">?</span> <span class="n">pending_data</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">:</span>
                        <span class="mh">64&#39;h0</span><span class="p">;</span>

    <span class="k">assign</span> <span class="n">write_rn</span> <span class="o">=</span> <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P1</span> <span class="o">?</span> <span class="n">pending_rn</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">:</span>
                      <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P2</span> <span class="o">?</span> <span class="n">pending_rn</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">:</span>
                      <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P3</span> <span class="o">?</span> <span class="n">pending_rn</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">:</span>
                      <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P4</span> <span class="o">?</span> <span class="n">pending_rn</span><span class="p">[</span><span class="mh">4</span><span class="p">]</span> <span class="o">:</span>
                      <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P5</span> <span class="o">?</span> <span class="n">pending_rn</span><span class="p">[</span><span class="mh">5</span><span class="p">]</span> <span class="o">:</span>
                      <span class="n">state</span> <span class="o">==</span> <span class="no">STATE_P6</span> <span class="o">?</span> <span class="n">pending_rn</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">:</span>
                      <span class="mh">6&#39;h0</span><span class="p">;</span>

<span class="k">endmodule</span>
</pre></div>
</td></tr></table></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="de_canonicalize.html" class="btn btn-neutral float-right" title="de_canonicalize.v" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../modules.html" class="btn btn-neutral" title="Verilog Module Index" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Christopher Parish

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>